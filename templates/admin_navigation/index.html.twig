{% extends 'admin.html.twig' %}

{% block title %}{{ title }}{% endblock %}

{% block body %}

    <section class="block">

        {% if route_name == 'app_admin_nav' or route_name == 'app_admin_nav_select' %}
            <a class="btn-link float-right" href="{{ path('app_admin_nav_menu') }}">Créer un menu</a>
        {% elseif route_name == 'app_admin_nav_menu' %}
            <a class="btn-link float-right" href="{{ path('app_admin_nav') }}">Retour à la liste</a>
        {% endif %}

        <h2>{{ title }}</h2>

        {% if route_name == 'app_admin_nav' or route_name == 'app_admin_nav_select' %}
            <div id="popup-container">
                <iframe src="" frameborder="0" id="popup"></iframe>
            </div>
            
            <div class="nav-blocks">
                <div class="block links tab-container">
                    <ul class="tabs tabs-btn">
                        <li><a class="tab active">Pages</a></li>
                        <li><a class="tab">Posts</a></li>
                        <li><a class="tab">Lien</a></li>
                    </ul>
                    <div class="tab-panes mt">
                        {{ form_start(nav_form) }}
                        <div class="tab-pane active">
                            {% for item in nav_form.pages %}
                                <div class="item">
                                    {{ form_widget(item) }} {{ form_label(item) }}
                                </div>
                            {% endfor %}
                        </div>
                        <div class="tab-pane">
                            {% for item in nav_form.posts %}
                                <div class="item">
                                    {{ form_widget(item) }} {{ form_label(item) }}
                                </div>
                            {% endfor %}
                        </div>
                        <div class="tab-pane">
                            <p>{{ form_row(nav_form.cus_name) }}</p>
                            <p>{{ form_row(nav_form.cus_link) }}</p>
                        </div>
                        <div class="mt">
                            {{ form_row(nav_form.submit) }}
                        </div>
                        {{ form_end(nav_form) }}
                    </div>
                </div>

                <div class="block navsite">
                    {{ form_start(menu_form) }}
                        {{ form_widget(menu_form.nav_select, { 'value': id_menu }) }}
                    {{ form_end(menu_form) }}

                    <div 
                        id="drag-drop-list" 
                        data-url="{{ path('order_nav_link') }}" 
                        data-urldel="{{ path('delete_nav_link') }}">
                        {% if menu is not null %}
                            {% for item in menu.menulinks | sort((a, b) => a.orderlink <=> b.orderlink) %}
                                {% if item.parent is null %}
                                    <div class="nav-item nav-link-{{ item.id }}" data-order="{{ item.orderlink }}" data-id="{{ item.id }}">
                                        <div class="line">
                                            {% set postType = item.post is not null ? 'Post' %}
                                            {% set itemType = item.page is not null ? 'Page' : 'Lien' %}
                                            {% set cusname = item.cusname[0] ?: '' %}
                                            <span>[{{ itemType }}] {{ cusname }} {% if cusname %}<em>- {{ cusname }}</em>{% endif %}</span>
                                            <ul>
                                                <li><span class="nav-update" data-url="{{ path('app_admin_nav_manage_link', { id_link: item.id }) }}">Modifier</span></li>
                                                <li><span class="nav-remove" data-id="{{ item.id }}">Supprimer</span></li>
                                            </ul>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %} 
                        {% endif %}
                    </div>
                </div>
            </div>
        {% elseif route_name == 'app_admin_nav_menu' %}
            {{ form_start(menu_create_form) }}
            <p>{{ form_row(menu_create_form.name) }}</p>
            <p>
                {{ form_label(menu_create_form.pos) }}<br />
                {{ form_widget(menu_create_form.pos) }}
            </p>
            <p>{{ form_row(menu_create_form.submit) }}</p>
            {{ form_end(menu_create_form) }}
            <hr />
            {% for menu in menus %}
                <div class="line menu-{{ menu.id }}">
                    <p>{{ menu.name }}</p>
                    <ul>
                        <li><span 
                            class="menu-remove" 
                            data-id="{{ menu.id }}"
                            data-removeurl="{{ path('delete_link') }}">Supprimer</span></li>
                    </ul>
                </div>
            {% endfor %}
        {% endif %}
    </section>

{% endblock %}
